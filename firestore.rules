rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 認証済みかどうか
  	function isAuthenticated() {
      return request.auth != null;
    }

    // ユーザーIDの検証も含めて認証済みかどうか
  	function isMe(userId) {
    	return isAuthenticated() && userId == request.auth.uid;
    }

    function checkCreateTaskData(data) {
    	// keyはTaskに存在しているもののみ
      // titleは100文字以内
      // typeはFEATURE/CHORE/BUGの3種類のみ（正規表現）
      // などなど
      // こんなの → document.status.matches("^(TODO|IN_PROGRESS|DONE)$")
    	return data;
    }

  	match /users/{userId} {
    	allow get: if isMe(userId);
    }

		// match /tasks/{taskId} {
    // 	allow read: if request.auth.uid == task;
    // }

    // 全てのデータの読み書きを許可する
		match /{document=**} {
    	allow read, write: if true;
    }
  }
}